# XXXX: Testing Messages
- Name: testing-messages
- Author: Daniel Bluhm <daniel.bluhm@sovrin.org>
- Start Date: 2019-03-25
- PR:
- Jira Issue:

## Summary
[summary]: #summary

A message family defining messages used during testing against the Agent Test Suite.

## Motivation
[motivation]: #motivation

Without a message family for testing, running an agent against the test suite is a very manual process. These messages
reduce or remove the need for direct human interaction while testing and also make possible the testing of certain
complicated states.

## Tutorial
[tutorial]: #tutorial

### Warning

The `testing` message family is used for testing purposes only. No agent in production use should ever implement
handlers for these messages.


### Testing Keys

Each testing message is packed in agent wire level format using a keypair designated for testing. This ensures that
testing messages originate from an authorized source. Agents implementing the testing message family should provide some
mechanism for bootstrapping these keys into the wallet. Handlers for testing messages should always check that the
message originated from that key.

#### Testing Key Generation

The testing keys are generated each time the test suite is invoked. The test suite can be configured with a seed to
deterministically generate a key to simplify testing but agent implementations should not rely on this functionality.


## Reference
[reference]: #reference

### Initial Wallet Setup

The `initial_wallet_setup` message is used to set the initial state of the wallet for testing. It may be sent multiple
times through the testing process. Upon receipt of this message, the wallet open for testing should be cleared or a new
wallet opened.

```json
{
    "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/testing/1.0/initial_wallet_setup",
    "dids": [
        {
            "crypto_type": "ed25519",
            "did": "123456789abcdefghi",
            "seed": "0000000000000000000000000Example"
        },
        ...
    ],
    "keys": [
        {
            "crypto_type": "ed25519",
            "seed": "0000000000000000000000000Example"
        },
        ...
    ],
    "connections": [
        {
            "label": "example-connection",
            "my_did": "abcdefghi123456789",
            "their_did": "123456789abcdefghi",
            "their_did_doc": {
                "contents are": "specified in the connection HIPE"
            }
        },
        ...
    ]
}
```

- `dids` - A list of dids to be generated by the receiving (tested) agent. *Note:* This generates both the DID and the
    keypair used with that DID.
    - `crypto_type` - (string; required) right now, only `"ed25519"` is supported.
    - `did` - (string; optional) The DID to be generated. If not specified, the did will be the Base 58 of the first 16
        bits of the verification key.
    - `seed` - (string; required) The seed for deterministic key and DID generation.
- `keys` - A list of keys to be generated by the receiving (tested) agent. *Note:* These are not keys associated with a
    did in the wallet; `keys` refers to stand alone keys such as a connection key (see connection protocol HIPE).
    - `crypto_type` - (string; required) right now, only `"ed25519"` is supported.
    - `seed` - (string; required) The seed for deterministic key generation.
- `connections` - A list of connections to be set up by the receiving (tested) agent. The contents of each object in
    this list are closely related to what is sent in a connection request message as defined in the connection protocol
    HIPE.
    - `label` - (string; required) The label for this connection.
    - `my_did` - (string; required) The DID of the receiving (tested) agent. If my agent received this message,
        `my_did` is the DID *my* agent would use for this connection.
    - `their_did` - (string; required) The DID of the other party for this connection.
    - `their_did_doc` - DID Doc object. This object looks identical to the `did_doc` object in the connection request
        and response messages from the connection protocol HIPE.

## Drawbacks
[drawbacks]: #drawbacks

Why should we *not* do this?

## Rationale and alternatives
[alternatives]: #alternatives

- Why is this design the best in the space of possible designs?
- What other designs have been considered and what is the rationale for not
choosing them?
- What is the impact of not doing this?

## Prior art
[prior-art]: #prior-art

The testing message family is similar to the "agact" back channel communication method described in the [test suite
interface HIPE](https://github.com/hyperledger/indy-hipe/tree/master/text/0015-agent-test-suite-interface).

## Unresolved questions
[unresolved]: #unresolved-questions

